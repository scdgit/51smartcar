# 51智能小车

### 1. 超声波模块

> HC-SR04模块采用IO口 TRIG 触发测距，至少给 10us 的高电平信号；模块自动发送 8 个 40khz 的方波，自动检测是否有信号返回；有信号返回 ECHO 输出一个高电平，电平持续的时间就是超声波发射到返回的时间。

#### 1.1 引脚说明

- Vcc：电源
- Trig：触发器引脚（发送信号）
- Echo：接收引脚（接收信号）
- Gnd：接地

#### 1.2 计算公式

测试距离=（高电平时间 * 声速（340 m/s））/ 2 

#### 1.3 驱动程序

完整代码

1.HCSR04.H 头文件

2.HCSR04.c 文件

管脚定义

```c
sbit TrigPort = P2^6; // 触发器引脚
sbit EchoPort = P2^7; // 接收引脚
```

设置定时器

```c
TMOD |= 0x01;
TH0 = 0;
TL0 = 0;
ET0 = 1; // 允许T0中断
EA = 1; // 开启总开关
```

发送信号

```c
TrigPort = 1;
delay_10us(2);
TrigPort = 0;
timer = 0;
```

接收信号

```c
// 清除上次的计时时间
TH0 = 0;
TL0 = 0;

// 等待接收信号
while(!EchoPort);
TR0 = 1; // 开始计时
while(EchoPort);
TR0 = 0; // 计时结束

// 计算距离(cm)
s = (TH0 * 256 + TL0) * 0.034 / 2;
```

